{% extends "base.html" %}

{% block head %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" integrity="sha512-ElRFoEQdI5Ht6kZvyzXhYG9NqjtkmlkfYk0wr6wHxU9JEHakS7UJZNeml5ALk+8IKlU6jDgMabC3vkumRokgJA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
{% endblock %}

{% block content %}
    <turbo-frame id="messages">
    {% if messages %}
        {% include "fragments/messages.html" %}
    {% endif %}
    </turbo-frame>
    <nav id="breadcrumbs" class="breadcrumbs pb-2 mb-2 ml-2 md:ml-0">
        <a href="{% url "posts" %}" class="underline">Health</a><span class="ml-2">> Top</span>
    </nav>
    <main class="mt-2 ml-2 md:ml-0">
        <nav>
            <a href="{% url "plugin_health_admin:add_daily_health" %}" data-turbo-frame="_top" class="primary-button"><span class="mr-1">ðŸŒ…</span><span class="hover:underline">Add Daily Health</span></a>
        </nav>
        {% if weight and mood %}
        <section class="mt-2">
            <h1>Most recently you were...</h1>
            <div class="mt-2 mx-auto mx-2 grid grid-cols-2 gap-2 text-center">
                <p class="text-4xl">{{ weight.measurement }}{{ weight.unit }}</p>
                <p class="text-4xl">{{ mood.emoji }}</p>
            </div>
        </section>
        <section class="mt-2">
            <canvas id="weightChart" width="400" height="300" class="max-w-prose" style="height: 300px;"></canvas>
        </section>
        {% endif %}
    </main>
{% endblock %}


{% block body_end %}
    <script>
    const ctx = document.getElementById('weightChart');

    async function drawChart() {
        const response = await fetch("{% url 'plugin_health_admin:graph_api' %}");
        const data = await response.json();
        const weightChart = new Chart(ctx, {
            type: "line",
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Last 10 measurements',
                        color: "#938070",
                    },
                     legend: {
                        display: true,
                         position: "bottom",
                        labels: {
                            color: "#938070"
                        }
                    }
                }
            },
            data: {
                labels: data.labels,
                datasets: [
                    {
                        label: "{{ weight.measurement }}",
                        data: data.weight,
                        fill: true,
                        borderColor: "#11722c",
                        pointRadius: 0,
                    },
                ],
            },
        });
    }
    drawChart();
</script>
{% endblock %}